<?php
/**
 *  ocs-webserver
 *
 *  Copyright 2016 by pling GmbH.
 *
 *    This file is part of ocs-webserver.
 *
 *    This program is free software: you can redistribute it and/or modify
 *    it under the terms of the GNU Affero General Public License as
 *    published by the Free Software Foundation, either version 3 of the
 *    License, or (at your option) any later version.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    GNU Affero General Public License for more details.
 *
 *    You should have received a copy of the GNU Affero General Public License
 *    along with this program.  If not, see <http://www.gnu.org/licenses/>.
 **/
?>
<!DOCTYPE html>
<html>
<head>
    <title>Download/Install</title>
    <script src='https://www.google.com/recaptcha/api.js'></script>
</head>
<body>
    <main id="ads-page">   
        <center>
            <div style="height: 500px; width: 400px">            
                <?php
                
                $errors = array();

                if ($_SERVER['REQUEST_METHOD'] == 'POST') { 

                    if (empty($errors) === true) {

                        if (empty($_POST['captcha_entered'])) {
                            $errors[] = '<p class = "input-error">Please answer the Captcha Question</p>';
                        } elseif ($_REQUEST['captcha_entered']!=$_SESSION['rand_code']) {
                            $errors[] = '<p class = "input-error">Your answer to the Math Question is incorrect.</p>';
                        }
                    }   
                }
                ?>

                <div class="">
                    <div class="" style="margin-top:0px;margin-bottom:15px;">
                        
                        <div class="" style="width:90%">
                            
                            <form id="Form1" name="Form1" action="" method="POST">
                            <?php
                            if (empty($_POST) === false && empty($errors) === true) {

                                echo '<script>document.location.href = "'.$this->url.'";</script>';

                            } else if (empty($errors) === false) {

                                echo output_errors($errors);
                            }
                            ?>
                             <p>
                                <img src="captcha.php" />
                                <input name="captcha_entered" style = "width: 100px !important;" type="text" id="captcha_entered" size="5" maxlength="2" placeholder = "Answer" />
                                <input type="hidden" name="captcha_total" id="captcha_total" value="<?php echo $_SESSION['rand_code']; ?>" />
                            </p>
                             <?php if($this->link_type == 'download') { ?>
                             <input type="submit" value="Start Download">
                             <?php } else { ?>
                             <input type="submit" value="Start Installation">
                             <?php } ?>
                            </form>   
                        </div>  
                    </div>
                </div>
                      
            </div>
        </center>        
    </main>

</body>
</html>



