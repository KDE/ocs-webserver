<?php
/**
 *  ocs-webserver
 *
 *  Copyright 2016 by pling GmbH.
 *
 *    This file is part of ocs-webserver.
 *
 *    This program is free software: you can redistribute it and/or modify
 *    it under the terms of the GNU Affero General Public License as
 *    published by the Free Software Foundation, either version 3 of the
 *    License, or (at your option) any later version.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    GNU Affero General Public License for more details.
 *
 *    You should have received a copy of the GNU Affero General Public License
 *    along with this program.  If not, see <http://www.gnu.org/licenses/>.
 **/

$modelInfo = new Default_Model_Info();
$this->comments = $modelInfo->getLatestComments(10);
$this->users = $modelInfo->getNewActiveMembers(18);
$this->supporters = $modelInfo->getNewActiveSupporters(18);

$this->productsThemesGTK = $modelInfo->getLastProductsForHostStores(5,"366,363,273,267,138,125,131,153");
$this->productsThemesPlasma = $modelInfo->getLastProductsForHostStores(5,"365,119,123,266,114,118,349,417,101,100,111");
$this->productsThemesBox = $modelInfo->getLastProductsForHostStores(5,"117,267,139,143,142,140,141,144");
$this->productsIconsCursors= $modelInfo->getLastProductsForHostStores(5,"386,107");
$this->productsScreenshots= $modelInfo->getLastProductsForHostStores(5,225);
$this->productsApps = $modelInfo->getLastProductsForHostStores(5,233);
$this->productsAddons = $modelInfo->getLastProductsForHostStores(5,"152,277,384");
$this->productsWallpapers = $modelInfo->getLastProductsForHostStores(5,295);

$countSupporters = $modelInfo->getCountActiveSupporters();
$countMembers = $modelInfo->getCountMembers();

$helperBuildMemberUrl = new Default_View_Helper_BuildMemberUrl();
$helperImage = new Default_View_Helper_Image();
$helpPrintDate = new Default_View_Helper_PrintDate();
?>
<main id="explore-content" class="startpage-store" >
<div class="GridFlex">
<div class="GridFlex-cell sidebar-left">  
        <?php  echo $this->render('explore/partials/filter.phtml'); ?> 
</div>
<div class="GridFlex-cell content">   
        <div class="contentcontainer">
                        <div class="row">   
                        <?php                                 
                                    echo $this->partial('/home/partials/product_group.phtml', array(
                                            "title"  => "GTK-Theming",
                                            "products" => $this->productsThemesGTK
                                        )
                                    );       

                                    echo $this->partial('/home/partials/product_group.phtml', array(
                                            "title"  => "Plasma-Theming",
                                            "products" => $this->productsThemesPlasma
                                        )
                                    );                                 
                        ?>                                                      
                        </div>

                        <div class="row blockpadding">   
                        <?php                                 
                                    echo $this->partial('/home/partials/product_group.phtml', array(
                                            "title"  => "Box-Theming",
                                            "products" => $this->productsThemesBox
                                        )
                                    );       

                                    echo $this->partial('/home/partials/product_group.phtml', array(
                                            "title"  => "Icons,Cursors",
                                            "products" => $this->productsIconsCursors
                                        )
                                    );                                 
                        ?>                                                                                                                        
                        </div>

                        <div class="row blockpadding">
                        <?php                                 
                                    echo $this->partial('/home/partials/product_group.phtml', array(
                                            "title"  => "Wallpapers",
                                            "products" => $this->productsWallpapers
                                        )
                                    );       

                                    echo $this->partial('/home/partials/product_group.phtml', array(
                                            "title"  => "Screenshots",
                                            "products" => $this->productsScreenshots
                                        )
                                    );                                 
                        ?>                                                                                                          
                        </div>
                        <div class="row blockpadding" >
                         <?php                                 
                                     echo $this->partial('/home/partials/product_group.phtml', array(
                                             "title"  => "Add-Ons",
                                             "products" => $this->productsAddons
                                         )
                                     );       

                                     echo $this->partial('/home/partials/product_group.phtml', array(
                                             "title"  => "Apps",
                                             "products" => $this->productsApps
                                         )
                                     );                                 
                         ?>                                         
                        </div>

                        <div class="row blockpadding supportersrow">
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <?php                                 
                                        echo $this->partial('/home/partials/users.phtml', array(
                                                "title"  => "Latest  Active Supporters",
                                                "users" => $this->supporters
                                            )
                                        );                   
                            ?>                                                              
                            </div>
                        </div>

                        <div class="row blockpadding">
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <?php                                 
                                        echo $this->partial('/home/partials/users.phtml', array(
                                                "title"  => "Latest  Community Members ",
                                                "users" => $this->users
                                            )
                                        );                   
                            ?>                                               
                            </div>
                        </div>                        
             </div>
</div>
<div class="GridFlex-cell sidebar-right">   
        <aside  id="explore-sidebar" >     
        <div class="downloadDiv" >
            <a href="https://www.opendesktop.org/p/1175480/" target="_blank"><img src="/images/system/download-app.png" /></a>
        </div>

        <div class="supportDiv" >
        <?php 
                $identity = Zend_Auth::getInstance()->getIdentity();
                if(null == $identity || (null != $identity && !$this->isSupporter($identity->member_id))) {                                                  
        ?>
            <a href="/support" class="btn btn-primary btn-lg active btn-block" role="button" aria-pressed="true">Become a Supporter<br>of Opendesktop.org</a>
        <?php   } else if((null != $identity && $this->isSupporter($identity->member_id))) { ?>
            <a href="/support" class="btn btn-primary btn-lg active btn-block" role="button" aria-pressed="true">Support<br>Opendesktop.org</a>
        <?php   }?>
        </div>

        <div  class="supportDiv  withborder" >    
        <span><b><?=$countSupporters?></b> people support </span>        
        <span style="display: block"><?php /*number_format($countMembers, 0, '.', ',');*/?>
        those who support freedom
         </span>
        </div>

        <div  class="row sidebar-right-info" >                                
            <span class="newsTitle"> News </span>
            <div class="prod-widget-box right bgwhite " id="rss-feeds"> </div>                  
      
        <span class="newsTitle"> Lastest Comments </span>
         <div class="prod-widget-box right bgwhite" id="lastcomments">
                <?php
                foreach ($this->comments as $this->comment) {
                    echo $this->render('explore/partials/comment.phtml');
                }
                ?>
            </div>          
        </aside>
</div>
</div>

</main>

<?php $this->inlineScript()->appendScript(
    '    $(document).ready(function(){                               
                RssNews.setup();                  
            });
        ');