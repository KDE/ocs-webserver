
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <!--
    Modified from the Debian original for Ubuntu
    Last updated: 2014-03-19
    See: https://launchpad.net/bugs/1288690
  -->
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>D3</title>    
    <style type="text/css">
     body{
     	font-family: sans-serif;
     	font-size: 12px;
     }
    </style>
 </head>
  <body>
<div style="width: 65%">
	<div style="display: block; float: right; width: 300px" id="detailContainer">

	</div>
	<div>
	<div id="pie" style="padding:50px; "></div>

	<div id="pie2" style="padding:50px;"></div>

	<div id="pie3" style="padding:50px; "></div>
	</div>
</div>
<script src="//d3js.org/d3.v4.min.js"></script>
<script src="theme/flatui/js/lib/d3pie.min.js"></script>
<script>

  d3.csv("data/payout_201707.csv",function(d) {
   return {
      label:d.MemberId+'['+d.Amount+']',
      value: +d.Amount,
      member:d.MemberId
   }
}, function(data) {
      
      var pie = new d3pie("pie", {
          size: {
            canvasWidth: 590,
            pieOuterRadius: "90%"           
          },
          header: {
              title: {
                text: "Member payout_201707",
                fontSize: 24,
                font: "open sans"
                }
            },
          data: {
            sortOrder: "value-desc",
            smallSegmentGrouping: {
              enabled: true,
              value: 1,
              valueType: "percentage",
              label: "<2%"
            },
            content: data
          },
        callbacks: {
            onClickSegment: function(a) {
              if(!a.data.isGrouped)
              {
                  var url='https://opendesktop.org/member/'+a.data.member;
                  window.open(url,'_blank');
              }else{
                  console.log(a);
                  d3.select('#detailContainer').html('');

                  var dh='<table>';
                   var da = a.data.groupedData;                   
                   dh=dh+'<tr><td>#'+da.length+'</td><td>'+a.data.value+'</td></tr>';
                   da.forEach(function(d, i) {
                        dh=dh+'<tr><td><a target="_blank" href="https://opendesktop.org/member/'+d.member+'">'+d.member+'</a></td><td>'+d.value+'</td></tr>';                      
                    });
                   dh=dh+'</table>';
                  d3.select('#detailContainer').html(dh);
              }              
            }
          }
        });

  });

  d3.csv("data/payout_201706.csv",function(d) {
     return {
        label:d.MemberId+'['+d.Amount+']',
        value: +d.Amount,
        member:d.MemberId
     }
  }, function(data) {
        
        var pie = new d3pie("pie2", {
            size: {
              canvasWidth: 590,
              pieOuterRadius: "90%"           
            },
            header: {
                title: {
                  text: "Member payout_201706",
                  fontSize: 24,
                  font: "open sans"
                  }
              },
            data: {
              sortOrder: "value-desc",
              smallSegmentGrouping: {
                enabled: true,
                value: 1,
                valueType: "percentage",
                label: "<2%"
              },
              content: data
            },
          callbacks: {
              onClickSegment: function(a) {
                if(!a.data.isGrouped)
                {
                    var url='https://opendesktop.org/member/'+a.data.member;
                    window.open(url,'_blank');
                }else{
                    console.log(a);
                    d3.select('#detailContainer').html('');

                    var dh='<table>';
                     var da = a.data.groupedData;                   
                     dh=dh+'<tr><td>#'+da.length+'</td><td>'+a.data.value+'</td></tr>';
                     da.forEach(function(d, i) {
                          dh=dh+'<tr><td><a target="_blank" href="https://opendesktop.org/member/'+d.member+'">'+d.member+'</a></td><td>'+d.value+'</td></tr>';                      
                      });
                     dh=dh+'</table>';
                    d3.select('#detailContainer').html(dh);
                }              
              }
            }
          });

    });

  d3.csv("data/payout_201705.csv",function(d) {
     return {
        label:d.MemberId+'['+d.Amount+']',
        value: +d.Amount,
        member:d.MemberId
     }
  }, function(data) {
        
        var pie = new d3pie("pie3", {
            size: {
              canvasWidth: 590,
              pieOuterRadius: "90%"           
            },
            header: {
                title: {
                  text: "Member payout_201705",
                  fontSize: 24,
                  font: "open sans"
                  }
              },
            data: {
              sortOrder: "value-desc",
              smallSegmentGrouping: {
                enabled: true,
                value: 1,
                valueType: "percentage",
                label: "<2%"
              },
              content: data
            },
          callbacks: {
              onClickSegment: function(a) {
                if(!a.data.isGrouped)
                {
                    var url='https://opendesktop.org/member/'+a.data.member;
                    window.open(url,'_blank');
                }else{
                    console.log(a);
                    d3.select('#detailContainer').html('');

                    var dh='<table>';
                     var da = a.data.groupedData;                   
                     dh=dh+'<tr><td>#'+da.length+'</td><td>'+a.data.value+'</td></tr>';
                     da.forEach(function(d, i) {
                          dh=dh+'<tr><td><a target="_blank" href="https://opendesktop.org/member/'+d.member+'">'+d.member+'</a></td><td>'+d.value+'</td></tr>';                      
                      });
                     dh=dh+'</table>';
                    d3.select('#detailContainer').html(dh);
                }              
              }
            }
          });

    });
</script>
  </body>
</html>
