/* 
 * VenoBox - jQuery Plugin
 * version: 1.5.2
 * @requires jQuery
 *
 * Examples at http://lab.veno.it/venobox/
 * License: Creative Commons Attribution 3.0 License
 * License URI: http://creativecommons.org/licenses/by/3.0/
 * Copyright 2013-2014 Nicola Franchini - @nicolafranchini
 *
 */
(function(e){function j(){e.ajax({url:y,cache:false}).done(function(e){m.html('<div class="vbox-inline">'+e+"</div>");z(true)}).fail(function(){m.html('<div class="vbox-inline"><p>Error retrieving contents, please retry</div>');z(true)})}function F(){m.html('<iframe class="venoframe" src="'+y+'"></iframe>');z()}function I(){var e=y.split("/");var t=e[e.length-1];m.html('<iframe class="venoframe" src="//player.vimeo.com/video/'+t+'"></iframe>');z()}function q(){var e=y.split("/");var t=e[e.length-1];m.html('<iframe class="venoframe" allowfullscreen src="//www.youtube.com/embed/'+t+'"></iframe>');z()}function R(){m.html('<div class="vbox-inline">'+e(y).html()+"</div>");z()}function U(){w=e(".vbox-content").find("img");w.one("load",function(){z()}).each(function(){if(this.complete)e(this).load()})}function z(t){t=t||false;if(t!=true){e(window).scrollTop(0)}O.html(C);m.find(">:first-child").addClass("figlio");e(".figlio").css("width",s).css("height",a).css("padding",o).css("background",u);l=m.outerHeight();c=e(window).height();if(l+80<c){f=(c-l)/2;m.css("margin-top",f);m.css("margin-bottom",f)}else{m.css("margin-top","40px");m.css("margin-bottom","40px")}m.animate({opacity:"1"},"slow")}function W(){if(e(".vbox-content").length){l=m.height();c=e(window).height();if(l+80<c){f=(c-l)/2;m.css("margin-top",f);m.css("margin-bottom",f)}else{m.css("margin-top","40px");m.css("margin-bottom","40px")}}}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B;e.fn.extend({venobox:function(f){var l={framewidth:"",frameheight:"",border:"0",bgcolor:"#fff",titleattr:"title",numeratio:false,infinigall:false,overlayclose:true};var c=e.extend(l,f);return this.each(function(){var f=e(this);if(f.data("venobox")){return true}f.addClass("vbox-item");f.data("framewidth",c.framewidth);f.data("frameheight",c.frameheight);f.data("border",c.border);f.data("bgcolor",c.bgcolor);f.data("numeratio",c.numeratio);f.data("infinigall",c.infinigall);f.data("overlayclose",c.overlayclose);f.data("venobox",true);t=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?true:false;n=document.all&&!window.atob?true:false;f.click(function(l){function w(){S=f.data("gall");h=f.data("numeratio");v=f.data("infinigall");x=e('.vbox-item[data-gall="'+S+'"]');if(x.length>0&&h===true){M.html(x.index(f)+1+" / "+x.length);M.fadeIn()}else{M.fadeOut()}T=x.eq(x.index(f)+1);N=x.eq(x.index(f)-1);if(f.attr(c.titleattr)){C=f.attr(c.titleattr);O.fadeIn()}else{C="";O.fadeOut()}if(x.length>0&&v===true){k=true;L=true;if(T.length<1){T=x.eq(0)}if(x.index(f)<1){N=x.eq(x.index(x.length))}}else{if(T.length>0){e(".vbox-next").css("display","block");k=true}else{e(".vbox-next").css("display","none");k=false}if(x.index(f)>0){e(".vbox-prev").css("display","block");L=true}else{e(".vbox-prev").css("display","none");L=false}}}function z(e){if(e.keyCode===27){W()}}function W(){e("body").unbind("keydown",z);if(n){i.animate({opacity:0},500,function(){i.remove();e(".vwrap").children().unwrap();e(window).scrollTop(-b);A=false;f.focus()})}else{i.unbind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd");i.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(n){if(n.target!=n.currentTarget){return}i.remove();if(t){e(".vwrap").bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){e(".vwrap").children().unwrap();e(window).scrollTop(-b)});e(".vwrap").css("opacity","1")}else{e(".vwrap").children().unwrap();e(window).scrollTop(-b)}A=false;f.focus()});i.css("opacity","0")}}l.stopPropagation();l.preventDefault();f=e(this);r=f.data("overlay");s=f.data("framewidth");a=f.data("frameheight");o=f.data("border");u=f.data("bgcolor");k=false;L=false;A=false;y=f.attr("href");b=e(window).scrollTop();b=-b;B=f.data("css")||"";e("body").wrapInner('<div class="vwrap"></div>');p=e(".vwrap");g='<div class="vbox-overlay '+B+'" style="background:'+r+'"><div class="vbox-preloader">Loading...</div><div class="vbox-container"><div class="vbox-content"></div></div><div class="vbox-title"></div><div class="vbox-num">0/0</div><div class="vbox-close">X</div><div class="vbox-next">next</div><div class="vbox-prev">prev</div></div>';e("body").append(g);i=e(".vbox-overlay");d=e(".vbox-container");m=e(".vbox-content");M=e(".vbox-num");O=e(".vbox-title");m.html("");m.css("opacity","0");w();i.css("min-height",e(window).outerHeight());if(n){i.animate({opacity:1},250,function(){i.css({"min-height":e(window).outerHeight(),height:"auto"});if(f.data("type")=="iframe"){F()}else if(f.data("type")=="inline"){R()}else if(f.data("type")=="ajax"){j()}else if(f.data("type")=="vimeo"){I()}else if(f.data("type")=="youtube"){q()}else{m.html('<img src="'+y+'">');U()}})}else{i.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(t){if(t.target!=t.currentTarget){return}i.css({"min-height":e(window).outerHeight(),height:"auto"});if(f.data("type")=="iframe"){F()}else if(f.data("type")=="inline"){R()}else if(f.data("type")=="ajax"){j()}else if(f.data("type")=="vimeo"){I()}else if(f.data("type")=="youtube"){q()}else{m.html('<img src="'+y+'">');U()}});i.css("opacity","1")}if(t){p.css({position:"fixed",top:b,opacity:"0"}).data("top",b)}else{p.css({position:"fixed",top:b}).data("top",b);e(window).scrollTop(0)}var E={prev:function(){if(A)return;else A=true;r=N.data("overlay");s=N.data("framewidth");a=N.data("frameheight");o=N.data("border");u=N.data("bgcolor");y=N.attr("href");if(N.attr(c.titleattr)){C=N.attr(c.titleattr)}else{C=""}if(r===undefined){r=""}i.css("min-height",e(window).outerHeight());m.animate({opacity:0},500,function(){i.css("min-height",e(window).outerHeight()).css("background",r);if(N.data("type")=="iframe"){F()}else if(N.data("type")=="inline"){R()}else if(N.data("type")=="ajax"){j()}else if(N.data("type")=="youtube"){q()}else if(N.data("type")=="vimeo"){I()}else{m.html('<img src="'+y+'">');U()}f=N;w();A=false})},next:function(){if(A)return;else A=true;r=T.data("overlay");s=T.data("framewidth");a=T.data("frameheight");o=T.data("border");u=T.data("bgcolor");y=T.attr("href");if(T.attr(c.titleattr)){C=T.attr(c.titleattr)}else{C=""}if(r===undefined){r=""}i.css("min-height",e(window).outerHeight());m.animate({opacity:0},500,function(){i.css("min-height",e(window).outerHeight()).css("background",r);if(T.data("type")=="iframe"){F()}else if(T.data("type")=="inline"){R()}else if(T.data("type")=="ajax"){j()}else if(T.data("type")=="youtube"){q()}else if(T.data("type")=="vimeo"){I()}else{m.html('<img src="'+y+'">');U()}f=T;w();A=false})}};e("body").keydown(function(e){if(e.keyCode==37&&L==true){E.prev()}if(e.keyCode==39&&k==true){E.next()}});e(".vbox-prev").click(function(){E.prev()});e(".vbox-next").click(function(){E.next()});var X=".vbox-close, .vbox-overlay";if(!f.data("overlayclose")){X=".vbox-close"}e(X).click(function(t){P=".figlio";D=".vbox-prev";_=".vbox-next";H=".figlio *";if(!e(t.target).is(P)&&!e(t.target).is(_)&&!e(t.target).is(D)&&!e(t.target).is(H)){W()}});e("body").keydown(z);return false})})}});e(window).resize(function(){W()})})(jQuery);